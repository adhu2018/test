# This workflow will install Python dependencies, run tests and lint with a single version of Python
# For more information see: https://help.github.com/actions/language-and-framework-guides/using-python-with-github-actions

name: Python application

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  build:

    runs-on: windows-latest

    steps:
    - uses: actions/checkout@v2
    - name: Set up Python 3.7
      uses: actions/setup-python@v2
      with:
        python-version: 3.7
    - name: Install dependencies
      run: |
        python -m pip install --upgrade pip
        pip install requests
    - name: Test
      run: |
        pip list
    - name: download tools.py
      shell: python
      run: |
        import requests,os
        
        def reload_module(_module, path=None, raise_=False):
          if path:
            import sys
            sys_path_temp = list(sys.path)
            sys.path.insert(0, path)
          try:
            import importlib
            module_ = importlib.import_module(".", _module)
            _module_ = importlib.reload(module_)
            return _module_
          except (ImportError, ModuleNotFoundError) as err:
            if path:
              sys.path = sys_path_temp
            if raise_:
              raise err
            return None
        
        res = requests.get('https://github.com/adhu2018/tools/raw/master/tools.py')
        with open(os.environ["FILE_PATH"], 'wb') as f:
          f.write(res.content)
        tools = reload_module("tools", path=os.environ["FILE_PATH"])
        tools.meiriyiwen().print()
      env:
        FILE_PATH: ${{ github.workspace }}/.github/tools.py
    
        
